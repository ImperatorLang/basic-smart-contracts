# If Lovelace Paid Minting Policy
The `IfLovelacePaidMintingPolicy` only accepts minting of tokens for transactions that pay an amount of lovelaces to a defined wallet.

## Prerequisites
- Plutus and nix-shell installed on your computer according to [instructions](installing-plutus.md)
- Local copy of this repository, built according to [building instructions](building-the-basic-smart-contracts-repo.md)
- Cardano node and cli setup according to instructions on [cardano-node repository](https://github.com/input-output-hk/cardano-node)

## Brief
The following instructions are for deploying the built IfLovelacePaidMintingPolicy to Cardano blockchain.
Instructions are the same for all of the Cardano Blockchains, but you need to change the
"Network Magic" parameter according to your environment
Use one of the following Network Magics according to which network you want to work
| Network | Magic | Command |
| --- | --- | --- |
| Preview | `--testnet-magic 2` | `export MAGIC="--testnet-magic 2"` |
| Pre-Production | `--testnet-magic 1` | `export MAGIC="--testnet-magic 1"` |
| Mainnet | `--mainnet` | `export MAGIC="--mainnet"` |

The Cardano CLI commands are compatible with version 1.35.3
```
~  : cardano-cli --version
cardano-cli 1.35.3 - linux-x86_64 - ghc-8.10
git rev 950c4e222086fed5ca53564e642434ce9307b0b9
```

## Configure mining policy
Usage of the minting policy will require a minimum amount / fee to be paid to a specific wallet. We will now configure the minting policy so it knows which wallet to check and the minimum amount required for minting. 

### Generate payment address for owner
```
~/wallets  : cardano-cli address key-gen --normal-key --verification-key-file mp-pay-to-wallet.vkey --signing-key-file mp-pay-to-wallet.skey
~/wallets  : cardano-cli address build --payment-verification-key-file mp-pay-to-wallet.vkey $MAGIC --out-file mp-pay-to-wallet.addr
```

### Fetch Payment pub key hash for owner address
```
~/wallets  : cardano-cli address key-hash --payment-verification-key-file mp-pay-to-wallet.vkey --out-file mp-pay-to-wallet.pkh
```

The contents of your owner-wallet.pkh should now be a 64 byte hex, similar to but not identical to `df0bf673765ccce01f7cb46da22c39be0bc51433abf8e142da21cb8c`. 
All wallets have their own unique key hash

## Serialize minting policy script
Time has come to build your unique minting policy. This is accomplished with the following command.
This works in the way that the `mint-if-paid-to` executable compiles your minting policy using two parameters (following --)
| Parameter | Description | Example |
| --- | --- | --- |
| 1 | filename to save your plutus script as | `plutus-scripts/mint-if-paid-to-0-1.plutus` |
| 2 | owner wallet payment pub key hash | `df0bf673765ccce01f7cb46da22c39be0bc51433abf8e142da21cb8c` | 
| 3 | required amount of lovelaces required to mint | `2000000` |

```
[nix-shell:~/basic-smart-contracts]$ cabal exec mint-if-paid-to -- plutus-scripts/mint-if-paid-to-0-1.plutus df0bf673765ccce01f7cb46da22c39be0bc51433abf8e142da21cb8c 2000000
_______________________________________________
 Policy saved to file          : plutus-scripts/mint-if-paid-to-0-1.plutus
 addressToPay                  : df0bf673765ccce01f7cb46da22c39be0bc51433abf8e142da21cb8c
 Minimum lovelace required     : 2000000
 Parameter to contract         : ContractParam {addressToPay = 6466306266363733373635636363653031663763623436646132326333396265306263353134333361626638653134326461323163623863, minLovelaceAmount = 2000000}
 addressToPay    (obj type)    : PubKeyHash
 minLovelaceAmount (obj type)  : Integer
_______________________________________________

[nix-shell:~/basic-smart-contracts]$ 


```
The contents of your minting policy plutus script file should now look similar to
```
{
    "type": "PlutusScriptV1",
    "description": "",
    "cborHex": "590b89590b8601000033232332232333222323322333222323233332222323322332232323322323233322232333222323333333322222222323233332222323233223233322232323233223322323233333222223322332233223322332233223322230033002001222323253353055330053333573466e1cd55ce9baa0044800081088c98d4c104cd5ce02182102001f9999ab9a3370e6aae754009200023300832323232323232323232323333573466e1cd55cea805240004666666666602c66a048464646666ae68cdc39aab9d5002480008cc070c0d0d5d0a80118149aba135744a004464c6a60a266ae7014c14814013c4d55cf280089baa00135742a01466a04804a6ae854024ccd540add728151aba150083335502b75ca0546ae85401ccd40900e8d5d0a80319a81219aa825821bad35742a00a6464646666ae68cdc39aab9d5002480008cd4078c8c8c8cccd5cd19b8735573aa0049000119a81319a81e3ad35742a00460826ae84d5d1280111931a982a99ab9c057056054053135573ca00226ea8004d5d0a8011919191999ab9a3370e6aae7540092000233502433503c75a6ae854008c104d5d09aba2500223263530553357380ae0ac0a80a626aae7940044dd50009aba135744a004464c6a60a266ae7014c14814013c4d55cf280089baa00135742a00866a048eb8d5d0a80199a81219aa825bae200135742a00460666ae84d5d1280111931a982699ab9c04f04e04c04b135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a8011919191999ab9a3370ea00290031180d98191aba135573ca00646666ae68cdc3a801240084603460786ae84d55cf280211999ab9a3370ea00690011180d18151aba135573ca00a46666ae68cdc3a802240004603a6eb8d5d09aab9e5006232635304833573809409208e08c08a08808626aae7540044dd50009aba135744a004464c6a608266ae7010c1081000fc41044c98d4c100cd5ce249035054350004103f135573ca00226ea8004888d4c0f80094cd4c14cccd5cd19b88333222323230010053200135505e22335350530014800088d4d54130008894cd4c174ccd5cd19b8f00200905f05e13007001130060033200135505d22335350520014800088d4d5412c008894cd4c170ccd5cd19b8f00200705e05d10011300600333355304612001223355304d1200123535504700122335504a002335530501200123535504a00122335504d002333535504f0012330624800000488cc18c0080048cc18800520000013355304d1200123535504700122335504a002333535504c0012335530511200123535504b00122335504e002355053001001223335550480590020012335530511200123535504b00122335504e002355051001001333555043054002001504f33223530080012222222222333553052120012235302500222235302a00322335304c002253353067333573466e3c0500041a41a04cd418801401c401c801d416c024d4c15c00c88008d4c01000488008158158d4c15c00c8800415015441544cd5ce24812d4d696e696d756d207265717569726564206c6f76656c616365206e6f74207061696420746f2061646472657373000542212330010030022001222222222212333333333300100b00a00900800700600500400300220012212330010030022001122123300100300212001122123300100300212001122123300100300212001212222300400521222230030052122223002005212222300100520011232230023758002640026aa08c446666aae7c004940f88cd40f4c010d5d080118019aba200202d23232323333573466e1cd55cea801a4000466600e6464646666ae68cdc39aab9d5002480008cc034c0acd5d0a80119a8080139aba135744a004464c6a606266ae700cc0c80c00bc4d55cf280089baa00135742a006666aa016eb94028d5d0a80119a8063ae357426ae8940088c98d4c0b4cd5ce01781701601589aba25001135573ca00226ea800488848ccc00401000c00880048848cc00400c00880044cd54005d73ad112232230023756002640026aa08044646666aae7c008940e48cd40e0cd540bcc018d55cea80118029aab9e500230043574400605026ae84004488c8c8cccd5cd19b875001480008d4020c014d5d09aab9e500323333573466e1d4009200225008232635302733573805205004c04a04826aae7540044dd5000890911801001889100089000919191999ab9a3370e6aae7540092000233006300735742a0046eb4d5d09aba25002232635302133573804604404003e26aae7940044dd500091091980080180110009191999ab9a3370e6aae75400520002375c6ae84d55cf280111931a980e99ab9c01f01e01c01b1375400224464646666ae68cdc3a800a40084a00e46666ae68cdc3a8012400446a014600c6ae84d55cf280211999ab9a3370ea00690001280511931a981019ab9c02202101f01e01d01c135573aa00226ea8004484888c00c0104488800844888004480048c8cccd5cd19b8750014800880b88cccd5cd19b8750024800080b88c98d4c060cd5ce00d00c80b80b00a89aab9d3754002464646464646666ae68cdc3a800a4018401646666ae68cdc3a80124014401a46666ae68cdc3a801a40104660166eb8d5d0a8029bad357426ae8940148cccd5cd19b875004480188cc034dd71aba15007375c6ae84d5d1280391999ab9a3370ea00a9002119809180a1aba15009375c6ae84d5d1280491999ab9a3370ea00c90011180a180a9aba135573ca01646666ae68cdc3a803a400046026602c6ae84d55cf280611931a981019ab9c02202101f01e01d01c01b01a019018135573aa00826aae79400c4d55cf280109aab9e500113754002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024646464646666ae68cdc3a800a400446660106eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002300a300b357426aae7940188c98d4c044cd5ce00980900800780709aab9d5003135744a00226aae7940044dd5000909118010019110911998008028020019000919191999ab9a3370ea0029001118031bae357426aae79400c8cccd5cd19b875002480008c020dd71aba135573ca008464c6a601666ae700340300280240204d55cea80089baa001212230020032122300100320011122232323333573466e1cd55cea80124000466aa01e600c6ae854008c014d5d09aba25002232635300833573801401200e00c26aae7940044dd5000a4c240024002920103505431001112223335530081200150103355300d1200123535500700122335500a00235500f001333553008120012235355008002225335301933355301212001323350182233353500b00322002002001353500900122001335009225335301b002101d100101a23535500b001223300a0020050061003133501400400350110013355300d120012353550070012232335500b00330010053200135501f22533535014001135500f0032213535500d002225335301e3300c00200813355014007001130060030021221233001003002120011122123300100300211200132001355014221122253353500c00110022213300500233355300712001005004001112122230030041122122233002005004112122230010041120013200135500f22112253353500600115008221335009300400233553006120010040013200135500e2211222533535006001135350090032200122133353500b005220023004002333553007120010050040011122002122122330010040031200112212330010030021200122333573466e3c00800401401048800848800480052201002212330010030022001223370000400222464600200244660066004004002664466004910138646630626636373337363563636365303166376362343664613232633339626530626335313433336162663865313432646132316362386300482024bd0048848cc00400c0088005"
}
```

## Generating minting policy script address
The final step is to generate the minting policy script address. This address is used when you interact with it

```
~/smart-contracts  : cardano-cli address build --payment-script-file mint-if-paid-to-0-1.plutus $MAGIC --out-file mint-if-paid-to-0-1.addr
~/smart-contracts  : cat mint-if-paid-to-0-1.addr 
addr_test1wpy59dgfce89ue9slrlkqgdxaezx480gc6z0wj08jam7m7qmu2fcu

```
Once again, the address `addr_test1wpy59dgfce89ue9slrlkqgdxaezx480gc6z0wj08jam7m7qmu2fcu` is only an example of how your address should look.
You are now ready for interacting with your minting policy
